/*
CryptoWave-like Simple App
- Single-file React component (default export)
- Tailwind CSS for styling (no imports needed here; add Tailwind to your build)

How to use / replace the daily image:
1) Quick (local preview / GitHub Pages):
   - Put your daily image at `public/daily.png` (or root `daily.png`) and the app will load it as fallback.
   - Or use the "Upload daily image" button in the app to replace the image in-browser (saved to localStorage).
2) If you host on GitHub Pages: upload new `daily.png` to the repo root (or overwrite the same path in `gh-pages` branch) and the app will show the new image.
3) The upload button stores the image in the visitor's browser (localStorage). If you want a global change for everyone, replace `daily.png` on the server or the repo.

Features included:
- Clean responsive layout (header, main image section, simple analysis cards, footer)
- Image swap via upload (persists per user via localStorage)
- Minimal editable fields (title, subtitle, and 3 analysis cards) which you can edit in code or extend to connect to a CMS
- Export-friendly: the app is a single-file component you can drop into a CRA/Vite + Tailwind project

Files you will need in your project:
- index.html (root)
- src/main.jsx -> render this component
- tailwind.css configured
- public/daily.png (optional fallback image)

----------
*/

import React, { useEffect, useState, useRef } from "react";

export default function CryptoWaveApp() {
  // Editable content (you can replace these with props or remote data later)
  const [title, setTitle] = useState("CryptoWave by You — Analisa Gratis");
  const [subtitle, setSubtitle] = useState("Ringkas, tajam, dan bisa diganti gambar tiap hari");

  // Analysis cards (simple default data)
  const defaultCards = [
    { id: 1, heading: "Market Sentimen", body: "Bullish kecil — perhatikan vol dan support utama." },
    { id: 2, heading: "Top Pick", body: "PEPE — volume naik 6 jam terakhir, potential retest support." },
    { id: 3, heading: "Risk Note", body: "Hati-hati news besar dari AS — koreksi cepat mungkin terjadi." },
  ];
  const [cards, setCards] = useState(defaultCards);

  // Image handling: prefer localStorage dataURL, fallback to /daily.png
  const [imageDataUrl, setImageDataUrl] = useState(null);
  const fileInputRef = useRef(null);

  useEffect(() => {
    const stored = localStorage.getItem("cw_daily_image");
    if (stored) setImageDataUrl(stored);
  }, []);

  function handleUploadFile(e) {
    const f = e.target.files?.[0];
    if (!f) return;
    const reader = new FileReader();
    reader.onload = () => {
      const data = reader.result;
      try {
        localStorage.setItem("cw_daily_image", data);
        setImageDataUrl(data);
      } catch (err) {
        alert("Gagal menyimpan gambar ke localStorage (mungkin terlalu besar).\nSaran: gunakan file yang lebih kecil atau letakkan daily.png di public root.");
      }
    };
    reader.readAsDataURL(f);
  }

  function handleClearImage() {
    localStorage.removeItem("cw_daily_image");
    setImageDataUrl(null);
  }

  // Simple inline edit for cards
  function updateCard(id, field, value) {
    setCards((prev) => prev.map((c) => (c.id === id ? { ...c, [field]: value } : c)));
  }

  // Export for daily image URL (useful if you want to show how to replace programmatically)
  const dailyImageSrc = imageDataUrl || "/daily.png";

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900 p-4 md:p-8">
      <header className="max-w-4xl mx-auto mb-6">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-2xl md:text-3xl font-extrabold tracking-tight">{title}</h1>
            <p className="mt-1 text-sm text-slate-600">{subtitle}</p>
          </div>
          <div className="text-right">
            <div className="text-xs text-slate-500">Versi: 1.0 • Simple</div>
            <div className="mt-2 flex items-center gap-2">
              <label className="flex items-center gap-2 cursor-pointer text-sm bg-white border rounded-lg px-3 py-1 shadow-sm hover:shadow-md">
                <input ref={fileInputRef} type="file" accept="image/*" className="hidden" onChange={handleUploadFile} />
                <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V7M16 3v4M8 3v4" />
                </svg>
                Upload daily image
              </label>
              <button onClick={() => fileInputRef.current?.click()} className="sr-only">Upload</button>
              <button onClick={handleClearImage} className="text-sm text-red-600 hover:underline">Clear</button>
            </div>
          </div>
        </div>
      </header>

      <main className="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6">
        <section className="md:col-span-2 bg-white rounded-2xl shadow p-4 flex flex-col">
          <div className="flex items-center justify-between mb-3">
            <h2 className="text-lg font-semibold">Analisa Hari Ini</h2>
            <div className="text-sm text-slate-500">{new Date().toLocaleDateString()}</div>
          </div>

          <div className="flex-1 rounded-lg overflow-hidden border border-slate-100">
            {/* Display the daily image */}
            <img src={dailyImageSrc} alt="Daily analysis" className="w-full h-80 object-cover bg-slate-100" onError={(e)=>{(e.target).src='/daily.png'}} />
          </div>

          <div className="mt-4 flex gap-3">
            <button
              className="px-3 py-1 rounded-lg bg-slate-900 text-white text-sm shadow-sm"
              onClick={() => {
                // quick toggle sample: replace content or reset
                setTitle((t) => (t.includes("(Edited)") ? "CryptoWave by You — Analisa Gratis" : t + " (Edited)"));
              }}
            >
              Toggle title demo
            </button>
            <button
              className="px-3 py-1 rounded-lg border text-sm"
              onClick={() => {
                // quick share trick: copy link to clipboard (note: if hosted, replace with real URL)
                navigator.clipboard
                  .writeText(window.location.href)
                  .then(() => alert("Link halaman disalin ke clipboard"))
                  .catch(() => alert("Gagal menyalin link"));
              }}
            >
              Salin link
            </button>
          </div>
        </section>

        <aside className="bg-white rounded-2xl shadow p-4 flex flex-col gap-4">
          <div>
            <h3 className="text-sm font-medium text-slate-700">Ringkasan Cepat</h3>
            <p className="mt-2 text-sm text-slate-600">Ringkas, tanpa basa-basi — cocok untuk dibaca sebelum sekolah/kerja.</p>
          </div>

          <div className="space-y-3">
            {cards.map((c) => (
              <div key={c.id} className="bg-slate-50 p-3 rounded-lg border">
                <input
                  className="w-full font-semibold bg-transparent text-sm outline-none"
                  value={c.heading}
                  onChange={(e) => updateCard(c.id, "heading", e.target.value)}
                />
                <textarea
                  className="w-full mt-2 text-sm bg-transparent text-slate-700 resize-none outline-none"
                  rows={3}
                  value={c.body}
                  onChange={(e) => updateCard(c.id, "body", e.target.value)}
                />
              </div>
            ))}
          </div>

          <div className="mt-auto text-xs text-slate-500">Tip: untuk perubahan global (semua visitor), letakkan file image baru di <code className="bg-white px-1 rounded">/daily.png</code> pada hosting Anda.</div>
        </aside>
      </main>

      <footer className="max-w-4xl mx-auto mt-8 text-center text-sm text-slate-500">
        Dibuat untuk analisa gratis — ganti gambar setiap hari, edit teks bila perlu. Kalau mau saya bantu deploy ke GitHub Pages atau Hostinger, bilang aja.
      </footer>
    </div>
  );
}
